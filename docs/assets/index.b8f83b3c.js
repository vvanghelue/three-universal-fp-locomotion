import{d as e,R as t,M as n,D as o,a as i,c as a,V as r,G as s,S as c,C as d,P as l,W as u,s as p,A as y,b as m,e as f,T as g,f as h}from"./vendor.a6ee0d19.js";let w,v;!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const o=new URL(e,location),i=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,a)=>{const r=new URL(e,o);if(self[t].moduleMap[r])return n(self[t].moduleMap[r]);const s=new Blob([`import * as m from '${r}';`,`${t}.moduleMap['${r}']=m;`],{type:"text/javascript"}),c=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){a(new Error(`Failed to import: ${e}`)),i(c)},onload(){n(self[t].moduleMap[r]),i(c)}});document.head.appendChild(c)})),self[t].moduleMap={}}}("assets/");let b={};async function x(e){let a,r;if("tracked-pointer"==e.targetRayMode)return a=new t(.02,.04,32),r=new n({opacity:.5,transparent:!0,side:o}),new i(a,r)}let k;const j={left:null,right:null};function E(t){const n={active:!1,touchIdentifier:null,touchStartPosition:{x:0,y:0},innerCirclePosition:{x:0,y:0},vector:{x:0,y:0}};let o=a({},n);const i=document.createElement("div");i.classList.add("joystick-zone"),i.innerHTML='\n        <div class="joystick">\n        </div>\n        <div class="inner-circle"></div>\n    ';const r=i.querySelector(".joystick"),s=i.querySelector(".inner-circle");async function c(){i.classList.add("animate-joystick-start-position"),"left"===t&&(i.style.left="15px",r.style.top="70vh",r.style.left="20vw",s.style.top="70vh",s.style.left="20vw"),"right"===t&&(i.style.right="15px",r.style.top="70vh",r.style.left="80vw",s.style.top="70vh",s.style.left="80vw"),await e(200),i.classList.remove("animate-joystick-start-position")}function d({x:e,y:t}){s.style.top=`${t}px`,s.style.left=`${e}px`}return c(),r.style.bottom="20vh",s.style.bottom="20vh",i.addEventListener("touchstart",(e=>{r.classList.add("active"),s.classList.add("active"),o.active||(o.active=!0,o.touchIdentifier=e.targetTouches[0].identifier,o.touchStartPosition.x=e.targetTouches[0].pageX,o.touchStartPosition.y=e.targetTouches[0].pageY,function({x:e,y:t}){r.style.top=`${t}px`,r.style.left=`${e}px`}(o.touchStartPosition),d(o.touchStartPosition))})),i.addEventListener("touchmove",(e=>{if(o.active){const t=function({point:e,circleCenter:t,radius:n}){e.x,t.x,e.y,t.y;const o=Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)),i=(o-n)/o;return!(i<=0)&&{x:e.x+(t.x-e.x)*i,y:e.y+(t.y-e.y)*i}}({point:{x:e.touches.item(o.touchIdentifier).pageX,y:e.touches.item(o.touchIdentifier).pageY},circleCenter:o.touchStartPosition,radius:80});t?(o.innerCirclePosition.x=t.x,o.innerCirclePosition.y=t.y):(o.innerCirclePosition.x=e.targetTouches[0].pageX,o.innerCirclePosition.y=e.targetTouches[0].pageY),o.vector=function({center:e,point:t,radius:n}){return{x:(t.x-e.x)/n,y:-1*(t.y-e.y)/n}}({center:o.touchStartPosition,point:o.innerCirclePosition,radius:80}),d(o.innerCirclePosition)}})),i.addEventListener("touchend",(()=>{o=a({},n),setTimeout(c,100),r.classList.remove("active"),s.classList.remove("active")})),{getVector:()=>o.vector,element:i}}const L=document.createElement("style");L.innerHTML='\n    .virtual-joysticks {\n        position: fixed;\n        left: 0;\n        bottom: 0;\n    }\n    .virtual-joysticks .joystick-zone {\n        __background: rgba(0, 255, 0, .3);\n        position: fixed;\n        bottom: 15px;\n        width: calc(50vw - 30px);\n        height: calc(60vh - 30px);\n    }\n    .virtual-joysticks .joystick {\n        width: 1px;\n        height: 1px;\n        position: fixed;\n        transition: opacity 500ms ease;\n        opacity: .3;\n    }\n    .virtual-joysticks .joystick:after {\n        content: "";\n        display:block;\n        width: 160px;\n        height: 160px;\n        background: rgba(255, 255, 255, .2);\n        border: 2px solid rgba(255, 255, 255, .6);\n        border-radius: 50%;\n        transform: translate3d(-50%,-50%,0);\n    }\n    .virtual-joysticks .inner-circle {\n        width: 1px;\n        height: 1px;\n        position: fixed;\n        transition: opacity 500ms ease;\n        opacity: .5;\n    }\n    .virtual-joysticks .inner-circle:after {\n        content: "";\n        display:block;\n        width: 50px;\n        height: 50px;\n        background: rgba(255, 255, 255, .4);\n        border-radius: 50%;\n        transform: translate3d(-50%,-50%,0);\n    }\n\n    .animate-joystick-start-position .joystick,\n    .animate-joystick-start-position .inner-circle {\n        transition: 200ms ease;\n    }\n    .virtual-joysticks .joystick.active {\n        opacity: 1;\n    }\n    .virtual-joysticks .inner-circle.active {\n        opacity: 1;\n    }\n',document.head.appendChild(L);let S={};const R=window.inputSystem={initXRSession:async function({renderer:t,scene:n,rig:o,camera:i}){if(w=i,t.xr.enabled=!0,v=await navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor","hand-tracking"]}),!v)return console.log("session not there"),void alert("XR Session not started");v.addEventListener("end",(function(){console.log("session end"),v=null})),t.xr.setSession(v);for(const e of[0,1]){const n=t.xr.getController(e);n.addEventListener("connected",(async function(e){const t=await x(e.data);b[e.data.handedness]={hand:e.data.handedness,mesh:t},this.add(t)})),n.addEventListener("disconnected",(function(){this.remove(this.children[0])})),o.add(n)}return await async function(t,n,o){return new Promise((async function(i){for(o=o||"waitUntil : timeout on condition : "+t;!t();){if(n<0)throw new Error(o);await e(300),n-=300}i()}))}((function(){return b.left&&b.right}),5e3,"Controllers not loaded (timeout)")},getXRControllers:function(){return b},getXRGamepads:function(){const e=v&&v.inputSources;if(e){const t=[e[0],e[1]].filter((e=>e)),n=t.find((e=>"left"===e.handedness)),o=t.find((e=>"right"===e.handedness));return!(!n||!o)&&{left:n,right:o}}return null},getXRSession:function(){return v},getXRCamera:function(){return renderer.xr.getCamera(w)},initMobileInput:async function(){location.href.includes("localhost")||document.documentElement.requestFullscreen(),k=document.createElement("div"),k.classList.add("virtual-joysticks"),document.body.appendChild(k),j.left=E("left"),k.appendChild(j.left.element),j.right=E("right"),k.appendChild(j.right.element)},getMobileJoysticksValue:function(){return{left:j.left.getVector(),right:j.right.getVector()}},getKeyboardState:()=>S};function C({platform:e,camera:t,rig:n}){let o=new r(0,0,0);function i(){const n=new r;return"desktop"!=e.type&&"mobile"!=e.type||(t.getWorldDirection(n),n.y=0),"vr"==e.type&&(R.getXRControllers().left.mesh.parent.getWorldDirection(n),n.multiplyScalar(-1)),n}return"desktop"!=e.type&&"mobile"!=e.type||(t.rotation.order="YXZ"),"desktop"==e.type&&(document.body.requestPointerLock(),document.body.addEventListener("mousemove",(e=>{document.pointerLockElement===document.body&&(t.rotation.y-=e.movementX/500,t.rotation.x-=-e.movementY/500)}),!1)),{update(a){let s=0,c=0;if("desktop"==e.type){const e=R.getKeyboardState(),t=e.KeyW?1:0,n=e.KeyS?-1:0,o=e.KeyD?1:0;s=t+n,c=(e.KeyA?-1:0)+o}"mobile"==e.type&&(s=4*R.getMobileJoysticksValue().left.y,c=4*R.getMobileJoysticksValue().left.x,t.rotation.y-=R.getMobileJoysticksValue().right.x/40,t.rotation.x-=R.getMobileJoysticksValue().right.y/40),"vr"==e.type&&(s=-1*R.getXRGamepads().left.gamepad.axes[3],c=R.getXRGamepads().left.gamepad.axes[2]);const d=new r(0,0,0);d.add(i().multiplyScalar(s)).add(function(){const e=i();return e.cross(t.up),e}().multiplyScalar(c)).multiplyScalar(4*a),o.add(d);const l=Math.exp(-30*a)-1;o.addScaledVector(o,l),n.position.add(o)}}}function P({platform:e,overlay:t,camera:n,rig:o}){let i,a;return e.isEnabled("walk")&&(i=C({platform:e,camera:n,rig:o})),e.isEnabled("snap-turn")&&(a=function({rig:e}){let t=0;return{update(n){if((new Date).getTime()-t>200){const n=R.getXRGamepads();if(Math.abs(n.right.gamepad.axes[2])>.3){const c=n.right.gamepad.axes[2]>0?-1:1;o=e,i=R.getXRCamera().position,a=new THREE.Vector3(0,1,0),r=c*Math.PI/8,(s=void 0!==(s=!1)&&s)&&o.parent.localToWorld(o.position),o.position.sub(i),o.position.applyAxisAngle(a,r),o.position.add(i),s&&o.parent.worldToLocal(o.position),o.rotateOnAxis(a,r),t=(new Date).getTime()}}var o,i,a,r,s}}}({rig:o})),{update(t){e.isEnabled("walk")&&i.update(t),e.isEnabled("snap-turn")&&a.update(t)}}}let M;window&&(async()=>{M="desktop";if(window.navigator.userAgent.includes("Quest"))M="vr";else if(window.document){let e=function(){M="mobile",window.document.removeEventListener("touchstart",e)};window.document.addEventListener("touchstart",e)}})();const T={platforms:{desktop:{enabled:!0,features:{walk:{enabled:!0,bind:["arrows","wasd"]},jump:{enabled:!0,bind:"space"}}},vr:{enabled:!0,devices:["oculus-quest","valve-index"],features:{walk:{enabled:!0,follow:"controller-orientation"},run:{enabled:!0},"snap-turn":{enabled:!0,step:Math.PI/8},jump:{enabled:!0,bind:["oculus-quest-button-A","valve-index-A-button"]},climb:{enabled:!0},fly:{enabled:!0}}},mobile:{enabled:!0,forceOrientation:"landscape",features:{walk:{enabled:!0},jump:{enabled:!0}}}},world:{gravity:9.81}};async function X(e){let t,n;if(!M)throw new Error("Cannot detect platformType, you must handle at least an user-based click before starting locomotion system");const o=e.collisionObject;e.collisionObject=void 0;const i=e.rig;e.rig=void 0;const r=e.camera;e.camera=void 0;const s=e.renderer;e.renderer=void 0;const c=e.scene;e.scene=void 0;const d=(e=a(T,e)).platforms[M];return d.type=M,d.isEnabled=function(e){return d.features[e]&&d.features[e].enabled},function({renderer:e}){document.addEventListener("keydown",(e=>{S[e.code]=!0}),!1),document.addEventListener("keyup",(e=>{S[e.code]=!1}),!1)}({renderer:s}),"vr"===d.type&&(console.log("init vr session"),await R.initXRSession({renderer:s,scene:c,rig:i,camera:r}),console.log("VR session started")),"mobile"===d.type&&await R.initMobileInput(),t=function({collisionObject:e}){return{update(e){}}}({collisionObject:o}),n=P({platform:d,overlay:undefined,camera:r,rig:i}),{update(e){n.update(e),t.update(e)},on(){},getPlatform:()=>d}}let V,A,H;window.openExample1=()=>{(new s).setPath("./").load("demo-scene/demo-scene.glb",(function(e){console.log("demo scene loaded"),function(e){document.body.innerHTML="";const t=document.createElement("div");t.innerHTML="START",t.style.fontSize="30px",t.style.cursor="pointer",t.style.background="white",t.style.padding="15px 20px",t.style.color="black",t.style.fontWeight="bold",t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate3d(-50%, -50%, 0)",document.body.appendChild(t),t.addEventListener("click",(()=>{t.remove(),e()}))}((async function(){V=new c,V.background=new d(11259375),A=window.camera=new l(50,window.innerWidth/window.innerHeight,.1,1e5),A.position.set(0,1.7,0),A.lookAt(100,0,100),H=window.renderer=new u({antialias:!1}),H.setPixelRatio(window.devicePixelRatio),H.setSize(window.innerWidth,window.innerHeight),H.outputEncoding=p,window.addEventListener("resize",(function(){A.aspect=window.innerWidth/window.innerHeight,A.updateProjectionMatrix(),H.setSize(window.innerWidth,window.innerHeight)}),!1),document.body.appendChild(H.domElement);const t=new y(5592575);t.intensity=.5,V.add(t);new m(16711714,.5).position.set(-5,25,-5);const n=new f;n.position.set(0,0,0),V.add(n),n.add(A),V.add(e.scene);const o=await X({collisionObject:e.scene,renderer:H,scene:V,rig:n,camera:A}),i=new h;H.setAnimationLoop((function(){const e=i.getDelta();o.update(e),H.render(V,A)})),window.renderer1=H,window.THREE=g}))}))};
//# sourceMappingURL=index.b8f83b3c.js.map
